@inject IThemesService _theme
@inject IConfiguration _config
@inject IContentRepository _data
@inject IHoodCache _cache
@{
    var theme = _theme.CurrentTheme;
    ViewData["Title"] = "Administrator Tools";
}
@section buttons {
    <a class="btn btn-danger" href="@Url.Action("ResetCache")">
        Reset Cache
    </a>
}
<div class="row">
    <div class="col-md-4 col-md-push-8">
        <div class="right-column">
            <div class="m-b-md">
                <h5>
                    @ViewData["Title"]
                </h5>
            </div>
            <div>
                <div class="ibox-content">
                    <p>Advanced raw information and options for administration of the site.</p>
                    <p>WARNING: Please be cautious when modifying anything in this area. There may be a drastic effect on the site.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-8 col-md-pull-4">
        <div class="tabs-container">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#basics">App Settings</a></li>
                <li><a data-toggle="tab" href="#cache">Cache</a></li>
            </ul>
            <div class="tab-content">
                <div id="basics" class="tab-pane active">
                    <div class="panel-body">
                        <strong>View Site Setup</strong>
                        <p>
                            Here you can view the site's deep settings, these should NEVER be distributed or shown to anyone other than site administrators. To modify these settings you can edit the appSettings.json file in the site's root directory.
                        </p>
                    </div>
                    <div class="panel-body">
                        <ul class="list-group settings-list clear-list m-t">
                            @if (_config.IsDatabaseConfigured())
                            {
                                @if (_config.IsDatabaseConfigured())
                                {
                                    <li class="list-group-item">
                                        <span class="pull-right">
                                            @_config.GetConnectionSettings().DataSource
                                        </span>
                                        <span class="label label-success"><i class="fa fa-check"></i></span>
                                        <span>DataSource</span>
                                    </li>
                                    <li class="list-group-item">
                                        <span class="pull-right">
                                            @_config.GetConnectionSettings().UserID
                                        </span>
                                        <span class="label label-success"><i class="fa fa-check"></i></span>
                                        <span>UserID</span>
                                    </li>
                                    <li class="list-group-item">
                                        <span class="pull-right">
                                            Hidden for security. See your appSettings file, or Environment Variables.
                                        </span>
                                        <span class="label label-success"><i class="fa fa-check"></i></span>
                                        <span>Password</span>
                                    </li>
                                }
                                else
                                {
                                    <li class="list-group-item">
                                        <span class="pull-right">
                                            -
                                        </span>
                                        <span class="label label-danger"><i class="fa fa-close"></i></span> <span>Database not configured!</span>
                                    </li>
                                }
                            }
                            else
                            {
                                <span class="pull-right">
                                    -
                                </span>
                                <span class="label label-danger"><i class="fa fa-close"></i></span>
                                <span>Connection String</span>
                            }
                            <li class="list-group-item">
                                @if (_config["ASPNETCORE_ENVIRONMENT"].IsSet())
                                {
                                    <span class="pull-right">
                                        @_config["ASPNETCORE_ENVIRONMENT"]
                                    </span>
                                    <span class="label label-success"><i class="fa fa-check"></i></span> <span>Hosting Environment</span>
                                }
                                else
                                {
                                    <span class="pull-right">
                                        -
                                    </span>
                                    <span class="label label-danger"><i class="fa fa-close"></i></span> <span>Hosting Environment</span>
                                }
                            </li>
                            <li class="list-group-item">
                                <span class="pull-right">
                                    @string.Join(",", (_settings.GetContentSettings().GetAllowedTypes()).Select(c => c.Type))
                                </span>
                                <span class="label label-success"><i class="fa fa-check"></i></span> <span>Enabled Types</span>
                            </li>
                            <li class="list-group-item">
                                <span class="pull-right">
                                    @string.Join(",", (_settings.GetContentSettings().GetDisallowedTypes()).Select(c => c.Type))
                                </span>
                                <span class="label label-success"><i class="fa fa-check"></i></span> <span>Disabled Types</span>
                            </li>
                            <li class="list-group-item">
                                <span class="pull-right">
                                    @string.Join(",", (_settings.GetContentSettings().GetPublicTypes()).Select(c => c.Type))
                                </span>
                                <span class="label label-success"><i class="fa fa-check"></i></span> <span>Public Types</span>
                            </li>
                            <li class="list-group-item">
                                <span class="pull-right">
                                    @string.Join(",", (_settings.GetContentSettings().GetRestrictedTypes()).Select(c => c.Type))
                                </span>
                                <span class="label label-success"><i class="fa fa-check"></i></span> <span>Restricted Types</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="cache" class="tab-pane">
                    <div class="panel-body">
                        <strong>Cache Contents &amp; Reset</strong>
                        <p>
                            Here you can view the site's current cache and reset it if need be.
                        </p>
                    </div>
                    <div class="panel-body">
                        @foreach (string key in _cache.Keys.OrderBy(s => s))
                        {
                            <div class="list-group-item">
                                <div class="pull-right">
                                    <a class="btn btn-xs btn-danger" href="@Url.Action("RemoveCacheItem", new { key = key })">
                                        Remove
                                    </a>
                                </div>
                                <p>@key</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




