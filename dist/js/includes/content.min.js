$.hood||($.hood={}),$.hood.Content={Init:function(){$("body").on("click",".delete-content",this.Delete),$("body").on("click",".delete-content-field",this.Meta.Delete),$("body").on("click",".clone-content",this.Clone),$("body").on("click",".create-content",this.Create.Init),$("body").on("click",".publish-content",this.Publish),$("body").on("click",".archive-content",this.Archive),$("body").on("click",".create-content",this.Create.Init),$("body").on("click",".edit-category",this.Categories.Edit),$("body").on("click",".save-category",this.Categories.Save),$("body").on("click",".add-category",this.Categories.Add),$("body").on("click",".delete-category",this.Categories.Delete),$("body").on("click",".add-custom-field",this.Types.AddField),$("body").on("click",".delete-custom-field",this.Types.DeleteField),$("body").on("keyup","#Slug",function(){$(".slug-display").html($(this).val())}),$("#manage-content-list").doesExist()&&this.Manage.Init(),$("#edit-content").doesExist()&&this.Edit.Init(),$("#add-field-form").doesExist()&&this.Meta.Init()},Types:{AddField:function(){var e=$("#custom-field-name-"+$(this).data("id")).val(),t=$.hood.Content.Types.GetFieldsList($(this).data("id"));return exists=!1,$.each(t,function(t,o){o.Name==e&&(exists=!0)}),exists?void $.hood.Alerts.Error("Cannot insert two fields with the same number."):(newField={Name:"Custom."+$("#custom-field-name-"+$(this).data("id")).val(),Default:$("#custom-field-default-"+$(this).data("id")).val(),Type:$("#custom-field-type-"+$(this).data("id")).val(),System:!1},t.push(newField),$.hood.Content.Types.ReRenderFields(t,$(this).data("id")),$("#fields-"+$(this).data("id")).val(JSON.stringify(t)),void $.hood.Alerts.Success("Added field."))},DeleteField:function(){var e=$.hood.Content.Types.GetFieldsList($(this).data("id")),t=$(this).data("name");e=$.grep(e,function(e){return e.Name!=t}),$.hood.Content.Types.ReRenderFields(e,$(this).data("id")),$("#fields-"+$(this).data("id")).val(JSON.stringify(e)),$.hood.Alerts.Success("Deleted field.")},GetFieldsList:function(e){if(fieldsInput=$("#fields-"+e).val(),null!=fieldsInput&&""!=fieldsInput){var t=JSON.parse(fieldsInput);for(var o in t)if(t[o].hasOwnProperty("Name"))return t}return new Array},ReRenderFields:function(e,t){for(newList=$("#field-list-"+t).empty(),i=0;i<e.length;i++)fld="<tr><td class='col-xs-8'><strong>"+e[i].Name+"</strong> "+e[i].Type+"</td><td class='col-xs-4 text-right'>",e[i].System?fld+='<span class="label label-default">System Field</span>':fld+="<a class='delete-custom-field btn btn-xs bg-color-red txt-color-white' data-name='"+e[i].Name+"' data-id='"+t+"'><i class='fa fa-trash-o'></i></a>",fld+="</td></tr>",newList.append(fld)}},Categories:{Edit:function(e){$(this);e.preventDefault(),$.hood.Blades.OpenWithLoader(".edit-category","/admin/categories/edit/"+$(this).data("id")+"?type="+$(this).data("type"),null)},Save:function(e){$.post("/admin/categories/save/",$("#edit-category-form").serialize(),function(e){e.Success?($.hood.Inline.Reload(".categorylist"),swal({title:"Saved!",text:"The category has been saved.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem saving the category: "+e.Error,timer:1300,type:"error"})})},Add:function(e){$.post("/admin/categories/add/",$("#add-category-form").serialize(),function(e){e.Success?($.hood.Inline.Reload(".categorylist"),swal({title:"Saved!",text:"The category has been added.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem adding the category: "+e.Error,timer:1300,type:"error"})})},Delete:function(){var e=$(this);swal({title:"Are you sure?",text:"The field will be permanently removed.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(t){t?$.post("/admin/categories/delete/"+e.data("id"),null,function(e){e.Success?($.hood.Inline.Reload(".categorylist"),swal({title:"Deleted!",text:"The field has now been removed from the website.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem deleting the field: "+e.Errors,timer:1300,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})}},Manage:{Init:function(){$("#manage-content-list").hoodDataList({url:"/admin/content/get",params:function(){return{search:$("#manage-content-search").val(),sort:$("#manage-content-sort").val(),category:$("#manage-content-category").val(),type:$("#manage-content-list").data("type")}},pageSize:12,pagers:".manage-content-pager",template:"#manage-content-template",dataBound:function(){},refreshOnChange:".manage-content-change",refreshOnClick:".manage-content-click",serverAction:"GET"})},Filter:function(){return{search:$("#manage-content-search").val(),sort:$("#manage-content-sort").val()}},Refresh:function(){$("#manage-content-list").doesExist()&&$("#manage-content-list").data("hoodDataList").Refresh(),$.hood.Blades.Reload()}},Delete:function(e){var t=$(this);swal({title:"Are you sure?",text:"The content will be permanently removed.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(e){e?$.post("/admin/content/"+t.data("id")+"/delete",null,function(e){e.Success?($("#manage-content-list").doesExist()||(window.location="/admin/content/"+t.data("type")+"/manage/"),$.hood.Content.Manage.Refresh(),$.hood.Blades.Close(),swal({title:"Deleted!",text:"The content has now been removed from the website.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem deleting the content: "+e.Errors,timer:1300,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})},Publish:function(e){var t=$(this);swal({title:"Are you sure?",text:"The item will be visible on the website.",type:"warning",confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(e){e?$.post("/admin/content/"+t.data("id")+"/publish",null,function(e){e.Success?($.hood.Content.Manage.Refresh(),$.hood.Blades.Close(),swal({title:"Published!",text:"The item has now been published.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem publishing the item: "+e.Errors,timer:1300,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})},Archive:function(e){var t=$(this);swal({title:"Are you sure?",text:"The item will be hidden from the website.",type:"warning",confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(e){e?$.post("/admin/content/"+t.data("id")+"/archive",null,function(e){e.Success?($.hood.Content.Manage.Refresh(),$.hood.Blades.Close(),swal({title:"Archived!",text:"The item has now been archived.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem archiving the item: "+e.Errors,timer:1300,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})},Clone:function(e){var t=$(this);$.post("/admin/content/"+t.data("id")+"/clone",null,function(e){e.Success?(window.location="/admin/edit/"+e.id,swal({title:"Cloned!",text:"The content has now been cloned just forwarding you to the new content...",type:"success"}),$.hood.Content.Manage.Refresh(),$.hood.Blades.Close()):swal({title:"Error!",text:"There was a problem cloning the content: "+e.Errors,timer:1300,type:"error"})})},Create:{Init:function(e){var t=$(this);e.preventDefault(),$.hood.Blades.OpenWithLoader("button.create-content","/admin/content/"+t.data("type")+"/create/",$.hood.Content.Create.SetupCreateForm)},SetupCreateForm:function(){$("#create-content-form").find(".datepicker").datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,autoclose:!0,orientation:"bottom",format:"dd/mm/yyyy"}),$("#create-content-form").hoodValidator({validationRules:{cpTitle:{required:!0},cpExcept:{required:!0},cpPublishDate:{required:!0,ukdate:!0}},submitButtonTag:$("#create-content-submit"),submitUrl:"/admin/content/add",submitFunction:function(e){e.Success?($("#manage-content-list").data("hoodDataList").Refresh(),swal("Created!","The content has now been created!","success")):swal("Error","There was a problem creating the content:\n\n"+e.Errors,"error")}})}},Edit:{Init:function(){this.LoadEditors("#edit-content"),$.hood.Content.Upload.InitImageUploader(),tinymce.init({selector:".edit-content-editor",height:500,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media contextmenu paste code"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image hoodimage",link_class_list:[{title:"None",value:""},{title:"Button link",value:"btn btn-default"},{title:"Theme coloured button link",value:"btn btn-primary"},{title:"Popup image/video",value:"colorbox-iframe"},{title:"Button popup link",value:"btn btn-default colorbox-iframe"},{title:"Theme coloured button popup link",value:"btn btn-primary colorbox-iframe"},{title:"Large link",value:"font-lg"},{title:"Large button link",value:"btn btn-default btn-lg"},{title:"Large theme coloured button link",value:"btn btn-primary btn-lg"},{title:"Large popup image/video",value:"font-lg colorbox-iframe"},{title:"Large Button popup link",value:"btn btn-default btn-lg colorbox-iframe"},{title:"Theme coloured button popup link",value:"btn btn-primary btn-lg colorbox-iframe"}],setup:$.hood.Uploader.Load.Insert,content_css:[]}),tinymce.init({selector:".edit-content-editor-simple",height:500,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media contextmenu paste code"],menubar:!1,toolbar:"styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | undo redo | link image hoodimage",link_class_list:[{title:"None",value:""},{title:"Button link",value:"btn btn-default"},{title:"Theme coloured button link",value:"btn btn-primary"},{title:"Popup image/video",value:"colorbox-iframe"},{title:"Button popup link",value:"btn btn-default colorbox-iframe"},{title:"Theme coloured button popup link",value:"btn btn-primary colorbox-iframe"},{title:"Large link",value:"font-lg"},{title:"Large button link",value:"btn btn-default btn-lg"},{title:"Large theme coloured button link",value:"btn btn-primary btn-lg"},{title:"Large popup image/video",value:"font-lg colorbox-iframe"},{title:"Large Button popup link",value:"btn btn-default btn-lg colorbox-iframe"},{title:"Theme coloured button popup link",value:"btn btn-primary btn-lg colorbox-iframe"}],setup:$.hood.Uploader.Load.Insert,content_css:[]}),$("#designer-window").doesExist()&&this.Designer.Init(),$("body").on("click","#add-content-category",this.Categories.AddCategory),$("body").on("click",".remove-category",this.Categories.RemoveCategory);var e;new autoComplete({selector:"input.autocomplete-category",source:function(t,o){try{e.abort()}catch(e){}e=$.getJSON("/admin/content/categorysuggestions/",{query:t},function(e){o(e)})}})},Categories:{AddCategory:function(){$.post($(this).data("url"),{category:$("#content-category-name").val()},function(e){e.Success?$.hood.Alerts.Success("Added category."):$.hood.Alerts.Error("Couldn't add the category: "+e.Error),$.hood.Inline.Refresh(".categories")})},RemoveCategory:function(){alert("not implemented")}},Designer:{Window:$("#designer-window"),Area:function(){return $("#designer-window").contents().find("#editable-content")},Init:function(){$("body").on("change","#preview-size",function(){$("#designer-window").attr("class","designer-window "+$(this).val())}),$("body").on("change","#Body",function(){$.hood.Content.Designer.Area().html($(this).val())})}},LoadEditors:function(e){$(e).find(".datepicker").datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!0,calendarWeeks:!0,autoclose:!0,orientation:"bottom",format:"dd/mm/yyyy"})}},Meta:{Create:function(){$("#add-field-form").hoodValidator({validationRules:{cfName:{required:!0},cfType:{required:!0}},submitButtonTag:$("#add-field-submit"),submitUrl:"/admin/content/addmeta",submitFunction:function(e){e.Success?($.hood.Inline.Reload("#content-meta-fields"),swal("Created!","The field has now been created!","success")):swal("Error","There was a problem creating the content:\n\n"+e.Errors,"error")}})},Delete:function(){var e=$(this);swal({title:"Are you sure?",text:"The field will be permanently removed.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(t){t?$.post("/admin/content/deletemeta",{id:e.data("id")},function(e){e.Success?($.hood.Inline.Reload("#content-meta-fields"),$.hood.Blades.Close(),swal({title:"Deleted!",text:"The field has now been removed from the website.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem deleting the field: "+e.Errors,timer:1300,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})}},Upload:{InitImageUploader:function(){if($("#content-gallery-upload").doesExist()){Dropzone.autoDiscover=!1;var e=new Dropzone("#content-gallery-upload",{url:"/admin/content/upload/gallery?id="+$("#content-gallery-upload").data("id"),thumbnailWidth:80,thumbnailHeight:80,parallelUploads:5,previewTemplate:!1,paramName:"files",autoProcessQueue:!0,previewsContainer:!1,clickable:"#content-gallery-add",dictDefaultMessage:'<span><i class="fa fa-cloud-upload fa-4x"></i><br />Drag and drop files here, or simply click me!</div>',dictResponseError:"Error while uploading file!"});e.on("success",function(e,t){t.Success===!1?$.hood.Alerts.Error("Uploads failed: "+t.Error):$.hood.Alerts.Success("Uploads completed successfully.")}),e.on("addedfile",function(e){}),e.on("totaluploadprogress",function(e){document.querySelector("#gallery-total-progress .progress-bar").style.width=e+"%"}),e.on("sending",function(e){document.querySelector("#gallery-total-progress").style.opacity="1"}),e.on("complete",function(e){$.hood.Inline.Refresh(".gallery")}),e.on("queuecomplete",function(e){document.querySelector("#gallery-total-progress").style.opacity="0",$.hood.Inline.Refresh(".gallery")})}}}},$(window).load(function(){$.hood.Content.Init()});