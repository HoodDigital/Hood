$.hood||($.hood={}),$.hood.Uploader={Init:function(){$("body").on("click",".hood-image-attach",$.hood.Uploader.Load.Attach),$("body").on("click",".hood-image-insert",$.hood.Uploader.Load.Insert),$("body").on("click",".hood-image-set",$.hood.Uploader.Load.Set),$("body").on("click",".hood-image-switch",$.hood.Uploader.Load.Switch)},Switching:null,Current:{Attach:null},Load:{Attach:function(t){$.hood.Uploader.Attacher={Id:$(this).data("id"),Entity:$(this).data("entity"),Field:$(this).data("field"),Type:$(this).data("type"),Refresh:$(this).data("refresh"),Tag:$(this).data("tag"),Title:$(this).attr("title"),JsonField:$(this).data("json")},$.hood.Modals.Open("/admin/media/attach/",$.hood.Uploader.Attacher,".hood-image-attach",$.proxy(function(){$("#attach-media-title").html($.hood.Uploader.Attacher.Title),$("body").off("click",".attach-media-select",$.hood.Uploader.Complete.Attach),$("body").on("click",".attach-media-select",$.hood.Uploader.Complete.Attach),$.hood.Media.Manage.Init(),$.hood.Media.Upload.Init()},this))},Insert:function(t){t.addButton("hoodimage",{text:"Insert image...",icon:!1,onclick:function(){$.hood.Modals.Open("/admin/media/insert/",null,".hood-image-attach",$.proxy(function(){$("body").off("click",".media-insert",$.proxy($.hood.Uploader.Complete.Insert,t)),$("body").on("click",".media-insert",$.proxy($.hood.Uploader.Complete.Insert,t)),$.hood.Media.Manage.Init(),$.hood.Media.Upload.Init()},this))}})},Set:function(t){try{$.hood.Designer.Loader.Show()}catch(t){}$.hood.Uploader.Switching=$($(this).data("target")),params={Restrict:$(this).data("restrict")},$.hood.Modals.Open("/admin/media/select/",params,".hood-image-set",$.proxy(function(){$("#attach-media-title").html($(this).attr("title")),$("body").off("click",".media-select",$.hood.Uploader.Complete.Set),$("body").on("click",".media-select",$.hood.Uploader.Complete.Set),$.hood.Media.Manage.Init(),$.hood.Media.Upload.Init();try{$.hood.Designer.Loader.Hide()}catch(t){}},this))},Switch:function(t){try{$.hood.Designer.Loader.Show()}catch(t){}$.hood.Uploader.Switching=$(this),params={Tag:$(this).data("target"),Restrict:$(this).data("restrict")},$.hood.Modals.Open("/admin/media/select/",params,".hood-image-switch",$.proxy(function(){$("#attach-media-title").html($(this).attr("title")),$("body").on("click",".media-select",$.hood.Uploader.Complete.Switch),$.hood.Media.Manage.Init(),$.hood.Media.Upload.Init();try{$.hood.Designer.Loader.Hide()}catch(t){}},this))}},Complete:{Attach:function(t){$(this).data("temp",$(this).html()),$(this).addClass("loading").append('<i class="fa fa-refresh fa-spin"></i>');var o=$("."+$.hood.Uploader.Attacher.Tag);params={Id:$(this).data("id"),Entity:$(this).data("entity"),Field:$(this).data("field"),MediaId:$(this).data("media")},$.post("/admin/media/attach/",params,$.proxy(function(t){t.Success?($.hood.Alerts.Success("Attached!"),o.addClass("loading"),icon=t.Media.Icon,"Image"==t.Media.GeneralFileType&&(icon=t.Media.MediumUrl),o.css({"background-image":"url("+icon+")"}),o.find("img").attr("src",icon),o.removeClass("loading"),$.hood.Helpers.IsNullOrUndefined($.hood.Uploader.Attacher.JsonField)||($jsonField=$("#"+$.hood.Uploader.Attacher.JsonField),$jsonField.val(t.Json))):$.hood.Alerts.Error(t.Errors,"Error attaching.")},this)).done(function(){}).fail(function(t){$.hood.Alerts.Error(t.status+" - "+t.statusText,"Error communicating.")}).always($.proxy(function(t){$(this).removeClass("loading").html($(this).data("temp")),$.hood.Modals.Close("#attach-media-modal")},this))},Insert:function(t){url=$(t.target).data("url"),editor=this,editor.insertContent('<img alt="Your image..." src="'+url+'"/>'),$.hood.Modals.Close("#attach-media-modal")},Set:function(t){url=$(this).data("url"),tag=$.hood.Uploader.Switching,$(tag).each(function(){$(this).is("input")?$(this).val(url):($(this).attr("src",url),$(this).css({"background-image":"url("+url+")"}),$(this).find("img").attr("src",url))}),$.hood.Modals.Close("#attach-media-modal"),$.hood.Alerts.Success("Attached!")},Switch:function(t){url=$(this).data("url"),tag=$.hood.Uploader.Switching,$(tag).css({"background-image":"url("+url+")"}),$(tag).find("img").attr("src",url),$.hood.Modals.Close("#attach-media-modal"),$.hood.Alerts.Success("Attached!")}},RefreshImage:function(t,o,a){var e=$(t);e.addClass("loading"),$.get(o,{id:a},$.proxy(function(t){e.css({"background-image":"url("+t.SmallUrl+")"}),e.find("img").attr("src",t.SmallUrl),e.removeClass("loading")},this))}},$.hood.Uploader.Init();