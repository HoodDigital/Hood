$.hood||($.hood={}),$.hood.FileUpload=function(e,t){this.Options=$.extend({element:e,attachUrl:"/admin/media/attach",refreshUrl:null,imageTag:null,completeFunction:function(){}},t||{}),this.Options.refreshUrl=$(this.Options.element).data("refresh"),this.Options.imageTag=$(this.Options.element).data("tag"),this.Options.Image=$("."+this.Options.imageTag),this.Uploader=$(this.Options.element).kendoUpload({async:{saveUrl:"/admin/media/upload?entity="+$(this.Options.element).data("entity")+"&id="+$(this.Options.element).data("id")+"&field="+$(this.Options.element).data("field")+"&refresh="+this.Options.refreshUrl+"&tag="+this.Options.imageTag},success:$.proxy(function(e){$.hood.Alerts.Success("Uploaded!"),$.hood.Helpers.IsNullOrUndefined(this.Options.imageTag)||$.hood.Helpers.IsNullOrUndefined(this.Options.refreshUrl)||(this.Options.Image.addClass("loading"),$.get(this.Options.refreshUrl,{id:$(this.Options.element).data("id")},$.proxy(function(e){this.Options.Image.css({"background-image":"url("+e.SmallUrl+")"}),this.Options.Image.find("img").attr("src",e.SmallUrl),this.Options.Image.removeClass("loading"),this.Options.completeFunction()},this)))},this),error:function(e){e.files;"upload"===e.operation&&$.hood.Alerts.Error(e.XMLHttpRequest.response,"Error Uploading")},select:$.proxy(function(e){$.each(e.files,$.proxy(function(t,i){maxSize=4194304,$.hood.Helpers.IsNullOrUndefined($(this.Options.element).data("maxsize"))||(maxSize=Number($(this.Options.element).data("maxsize"))),yourSizeMb=(Number(i.size)/1048576).toFixed(2),maxSizeMb=(Number(maxSize)/1048576).toFixed(2),i.size>maxSize&&($.hood.Alerts.Error("The image file must be less than "+maxSizeMb+"Mb. Your file is "+yourSizeMb+"Mb.","File is too large!"),e.preventDefault()),allowedTypes="*",$.hood.Helpers.IsNullOrUndefined($(this.Options.element).data("type"))||(allowedTypes=$(this.Options.element).data("type"),"image"===allowedTypes&&(allowedTypes=".jpg.jpeg.gif.png.tiff.bmp"),"document"===allowedTypes&&(allowedTypes=".doc.docx.pdf.xls.xlsx.ppt.pptx")),"*"!==allowedTypes&&allowedTypes.contains(i.extension)===-1&&($.hood.Alerts.Error("The file you have provided is not one of the allowed types for this upload.","Wrong file type!"),e.preventDefault())},this))},this),multiple:!1})},$.fn.hoodFileUpload=function(e){return this.each(function(){var t=$(this);if(!t.data("hoodFileUpload")){var i=new $.hood.FileUpload(this,e);t.data("hoodFileUpload",i)}})},$(document).ready(function(){$(".hood-fileupload").each(function(){$(this).hoodFileUpload({attachUrl:$(this).data("attach")?$(this).data("attach"):"/admin/media/upload",refreshUrl:$(this).data("refresh")?$(this).data("refresh"):"",imageTag:$(this).data("tag")?$(this).data("tag"):""})})});