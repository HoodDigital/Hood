"use strict";$.hood||($.hood={}),$.hood.Media={Init:function(){$("body").on("click",".delete-media",$.hood.Media.Delete),$("body").on("click",".delete-directory",$.hood.Media.Directories.Delete),$("body").on("click",".create-directory",$.hood.Media.Directories.Create),$.hood.Media.Upload.Init(),$.hood.Media.Actions.Init()},Loaded:function(e){$.hood.Loader(!1)},BladeLoaded:function(e){$.hood.Media.LoadMediaPlayers()},Reload:function(e){$.hood.Inline.Reload($("#media-list"),e)},ReloadDirectories:function(e){$.hood.Inline.Reload($("#media-directories-list"),e)},Actions:{Init:function(){$("body").on("click",".hood-image-attach",$.hood.Media.Actions.Load.Attach),$("body").on("click",".hood-image-clear",$.hood.Media.Actions.Complete.Clear),$("body").on("click",".hood-image-insert",$.hood.Media.Actions.Load.Insert),$("body").on("click",".hood-media-select",$.hood.Media.Actions.Load.Select)},Target:null,Json:null,Current:{Attach:null},Load:{Attach:function(e){e.preventDefault(),$.hood.Media.Actions.Target=$($(this).data("tag")),$.hood.Media.Actions.Json=$($(this).data("json")),$.hood.Inline.Modal($(this).data("url"),function(){$.hood.Media.Reload(function(){$("body").off("click",".media-attach"),$("body").on("click",".media-attach",$.hood.Media.Actions.Complete.Attach)}),$.hood.Media.Upload.Init()})},Insert:function(e){e.addButton("hoodimage",{text:"Insert image...",icon:!1,onclick:function(){$.hood.Inline.Modal($(this).data("url"),function(){$.hood.Media.Reload(function(){$("body").off("click"),$("body").on("click",".media-insert",$.proxy($.hood.Media.Actions.Complete.Insert,e))}),$.hood.Media.Upload.Init()})}})},Select:function(e){$.hood.Media.Actions.Target=$($(this).data("target")),$.hood.Inline.Modal($(this).data("url"),function(){$.hood.Media.Reload(function(){$("body").off("click",".media-select"),$("body").on("click",".media-select",$.hood.Media.Actions.Complete.Select)}),$.hood.Media.Upload.Init()})}},Complete:{Attach:function(e){e.preventDefault(),$image=$.hood.Media.Actions.Target,$json=$.hood.Media.Actions.Json,$.post($(this).data("url"),function(e){$.hood.Helpers.ProcessResponse(e),e.Success&&(icon=e.Media.Icon,"Image"===e.Media.GeneralFileType&&(icon=e.Media.MediumUrl),$.hood.Helpers.IsNullOrUndefined($image)||($image.css({"background-image":"url("+icon+")"}),$image.find("img").attr("src",icon),$image.removeClass("loading")),$.hood.Helpers.IsNullOrUndefined($json)||$json.val(e.MediaJson))}).done(function(){$("#media-select-modal").modal("hide")}).fail($.hood.Inline.HandleError)},Insert:function(e){url=$(e.target).data("url"),editor=this,editor.insertContent('<img alt="Your image..." src="'+url+'"/>'),$.hood.Modals.Close("#attach-media-modal")},Select:function(e){url=$(this).data("url"),tag=$.hood.Media.Actions.Target,$(tag).each(function(){$(this).is("input")?$(this).val(url):($(this).attr("src",url),$(this).css({"background-image":"url("+url+")"}),$(this).find("img").attr("src",url))}),$.hood.Alerts.Success("Image URL has been inserted.<br /><strong>Remember to press save!</strong>"),$("#media-select-modal").modal("hide")},Clear:function(e){e.preventDefault(),$image=$($(this).data("tag")),$json=$($(this).data("json")),$.post($(this).data("url"),function(e){$.hood.Helpers.ProcessResponse(e),e.Success&&(icon=e.Media.Icon,"Image"===e.Media.GeneralFileType&&(icon=e.Media.MediumUrl),$.hood.Helpers.IsNullOrUndefined($image)||($image.css({"background-image":"url("+icon+")"}),$image.find("img").attr("src",icon),$image.removeClass("loading")),$.hood.Helpers.IsNullOrUndefined($json)||$json.val(e.Json))}).fail($.hood.Inline.HandleError)}},RefreshImage:function(e,o,a){var i=$(e);i.addClass("loading"),$.get(o,{id:a},$.proxy(function(e){i.css({"background-image":"url("+e.SmallUrl+")"}),i.find("img").attr("src",e.SmallUrl),i.removeClass("loading")},this))}},Upload:{Init:function(){if($("#media-add").doesExist()){$("#media-total-progress").hide(),Dropzone.autoDiscover=!1;var e=new Dropzone("#media-upload",{url:$.hood.Media.Upload.UploadUrl,thumbnailWidth:80,thumbnailHeight:80,parallelUploads:5,previewTemplate:!1,paramName:"files",autoProcessQueue:!0,previewsContainer:!1,clickable:"#media-add",dictDefaultMessage:'<span><i class="fa fa-cloud-upload fa-4x"></i><br />Drag and drop files here, or simply click me!</div>',dictResponseError:"Error while uploading file!"});e.on("success",function(e,o){$.hood.Helpers.ProcessResponse(o)}),e.on("addedfile",function(e){$("#media-total-progress .progress-bar").css({width:"0%"}),$("#media-total-progress .progress-bar .percentage").html("0%")}),e.on("totaluploadprogress",function(e){$("#media-total-progress .progress-bar").css({width:e+"%"}),$("#media-total-progress .progress-bar .percentage").html(e+"%")}),e.on("sending",function(e){$("#media-total-progress").fadeIn(),$("#media-total-progress .progress-bar").css({width:"0%"}),$("#media-total-progress .progress-bar .percentage").html("0%")}),e.on("complete",function(e){$.hood.Media.Reload()}),e.on("queuecomplete",function(e){$("#media-total-progress").hide(),$.hood.Media.Reload()})}},UploadUrl:function(){return $("#media-upload").data("url")+"?directory="+$("input[type='radio'][name='dir']:checked").val()}},Delete:function(e){var o=$(this);deleteMediaCallback=function(e){e&&$.post("/admin/media/delete",{id:o.data("id")},function(e){$.hood.Helpers.ProcessResponse(e),e.Success&&($.hood.Media.Reload(),$(".modal-backdrop").remove(),$(".modal").modal("hide"))})},$.hood.Alerts.Confirm("The media file will be permanently removed. This cannot be undone.","Are you sure?",deleteMediaCallback,type="warning",footer='<span class="text-warning"><i class="fa fa-exclamation-triangle"></i> Ensure this file is not attached to any posts, pages or features of the site, or it will appear as a broken image or file.</span>',confirmButtonText="Ok",cancelButtonText="Cancel")},RestrictDir:function(){var e=/[^0-9A-Za-z- ]*/g,o=$(this).val(),a=o.replace(e,"");o!==a&&$(this).val(a)},Directories:{Create:function(){$("body").on("keyup",".sweet-alert input",$.hood.Media.RestrictDir),Swal.fire({title:"Create directory",text:"Please enter a name for your new directory:",input:"text",inputAttributes:{placeholder:"Directory name...",autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Add Directory",showLoaderOnConfirm:!0,preConfirm:function(e){return e!==!1&&(""===e?(Swal.showValidationMessage("You didn't supply a directory name, we can't create one without it!"),!1):fetch("/admin/media/directory/add?directory=".concat(e)).then(function(e){return e.json()}).catch(function(e){Swal.showValidationMessage("Request failed: ".concat(e))}))},allowOutsideClick:function(){return!Swal.isLoading()}}).then(function(e){$.hood.Helpers.ProcessResponse(e.value),$.hood.Media.ReloadDirectories(),$.hood.Media.Reload(),$("body").off("keyup",".sweet-alert input",$.hood.Media.RestrictDir)})},Delete:function(e){var o=$(this);deleteDirectoryCallback=function(e){e&&$.post(o.data("url"),{directory:$("#Directory").val()},function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Media.ReloadDirectories(),$.hood.Media.Reload()})},$.hood.Alerts.Confirm("The directory and all files will be permanently removed.","Are you sure?",deleteDirectoryCallback,"error",'<span class="text-danger"><i class="fa fa-exclamation-triangle mr-2"></i><strong>This cannot be undone!</strong><br />Ensure these files are not attached to any posts, pages or features of the site, or it will appear as a broken image or file.</span>')}},Players:{},LoadMediaPlayers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".hood-media",o={techOrder:["azureHtml5JS","flashSS","html5FairPlayHLS","silverlightSS","html5"],nativeControlsForTouch:!1,controls:!0,autoplay:!1,seeking:!0};$(e).each(function(){try{if(player=$.hood.Media.Players[$(this).data("id")],player)try{player.dispose()}catch(e){console.log("There was a problem disposing the old media player: ".concat(e))}$.hood.Media.Players[$(this).data("id")]=amp($(this).attr("id"),o),player=$.hood.Media.Players[$(this).data("id")],player.src([{src:$(this).data("file"),type:$(this).data("type")}])}catch(e){console.log("There was a problem playing the media file: ".concat(e))}})}},$(document).ready($.hood.Media.Init);