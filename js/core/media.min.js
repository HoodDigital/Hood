"use strict";$.hood||($.hood={}),$.hood.Media={Init:function(){$("body").on("click",".delete-media",$.hood.Media.Delete),$("body").on("click",".delete-directory",$.hood.Media.Directories.Delete),$("body").on("click",".create-directory",$.hood.Media.Directories.Create),$.hood.Media.Upload.Init(),$.hood.Media.Actions.Init()},Loaded:function(e){$.hood.Loader(!1)},Reload:function(e){$.hood.Inline.Reload($("#media-list"),e)},Actions:{Init:function(){$("body").on("click",".hood-image-attach",$.hood.Media.Actions.Load.Attach),$("body").on("click",".hood-image-insert",$.hood.Media.Actions.Load.Insert),$("body").on("click",".hood-media-select",$.hood.Media.Actions.Load.Select),$("body").on("click",".hood-image-switch",$.hood.Media.Actions.Load.Switch)},Switching:null,Current:{Attach:null},Load:{Attach:function(e){$.hood.Media.Actions.Attacher={Id:$(this).data("id"),Entity:$(this).data("entity"),Field:$(this).data("field"),Type:$(this).data("type"),Refresh:$(this).data("refresh"),Tag:$(this).data("tag"),Title:$(this).attr("title"),JsonField:$(this).data("json")},$.hood.Modals.Open("/admin/media/attach/",$.hood.Media.Actions.Attacher,".hood-image-attach",function(){$.hood.Media.Reload(function(){$("body").off("click"),$("body").on("click",".attach-media-select",$.hood.Media.Actions.Complete.Attach)}),$.hood.Media.Upload.Init()})},Insert:function(e){e.addButton("hoodimage",{text:"Insert image...",icon:!1,onclick:function(){$.hood.Modals.Open("/admin/media/insert/",null,".hood-image-attach",function(){$.hood.Media.Reload(function(){$("body").off("click"),$("body").on("click",".media-insert",$.proxy($.hood.Media.Actions.Complete.Insert,e))}),$.hood.Media.Upload.Init()})}})},Select:function(e){$.hood.Media.Actions.Switching=$($(this).data("target")),$.hood.Modals.Open($(this).data("url"),null,".hood-image-select",function(){$.hood.Media.Reload(function(){$("body").off("click",".media-select"),$("body").on("click",".media-select",$.hood.Media.Actions.Complete.Select)}),$.hood.Media.Upload.Init()})},Switch:function(e){$.hood.Media.Actions.Switching=$(this),$.hood.Modals.Open($(this).data("url"),null,".hood-image-switch",function(){$.hood.Media.Reload(function(){$("body").off("click"),$("body").on("click",".media-select",$.hood.Media.Actions.Complete.Switch)}),$.hood.Media.Upload.Init()})}},Complete:{Attach:function(e){$(this).data("temp",$(this).html()),$(this).addClass("loading").append('<i class="fa fa-refresh fa-spin"></i>');var o=$("."+$.hood.Media.Actions.Attacher.Tag);params={Id:$(this).data("id"),Entity:$(this).data("entity"),Field:$(this).data("field"),MediaId:$(this).data("media")},$.post("/admin/media/attach/",params,function(e){e.Success?($.hood.Alerts.Success("Attached!"),o.addClass("loading"),icon=e.Media.Icon,"Image"===e.Media.GeneralFileType&&(icon=e.Media.MediumUrl),o.css({"background-image":"url("+icon+")"}),o.find("img").attr("src",icon),o.removeClass("loading"),$.hood.Helpers.IsNullOrUndefined($.hood.Media.Actions.Attacher.JsonField)||($jsonField=$("#"+$.hood.Media.Actions.Attacher.JsonField),$jsonField.val(e.Json))):$.hood.Alerts.Error(e.Errors,"Error attaching.")}).done(function(){}).fail(function(e){$.hood.Alerts.Error(e.status+" - "+e.statusText,"Error communicating.")}).always($.proxy(function(e){$(this).removeClass("loading").html($(this).data("temp")),$.hood.Modals.Close("#attach-media-modal")},this))},Insert:function(e){url=$(e.target).data("url"),editor=this,editor.insertContent('<img alt="Your image..." src="'+url+'"/>'),$.hood.Modals.Close("#attach-media-modal")},Select:function(e){url=$(this).data("url"),tag=$.hood.Media.Actions.Switching,$(tag).each(function(){$(this).is("input")?$(this).val(url):($(this).attr("src",url),$(this).css({"background-image":"url("+url+")"}),$(this).find("img").attr("src",url))}),$.hood.Alerts.Success("Image URL has been inserted.<br /><strong>Remember to press save!</strong>"),$("#media-select-modal").modal("hide")},Switch:function(e){url=$(this).data("url"),$tag=$.hood.Media.Actions.Switching,$tag.css({"background-image":"url("+url+")"}),$tag.find("img").attr("src",url),$.hood.Modals.Close("#attach-media-modal"),$.hood.Alerts.Success("Attached!")}},RefreshImage:function(e,o,t){var a=$(e);a.addClass("loading"),$.get(o,{id:t},$.proxy(function(e){a.css({"background-image":"url("+e.SmallUrl+")"}),a.find("img").attr("src",e.SmallUrl),a.removeClass("loading")},this))}},Upload:{Init:function(){if($("#media-add").doesExist()){$("#media-total-progress").hide(),Dropzone.autoDiscover=!1;var e=new Dropzone("#media-upload",{url:$.hood.Media.Upload.UploadUrl,thumbnailWidth:80,thumbnailHeight:80,parallelUploads:5,previewTemplate:!1,paramName:"files",autoProcessQueue:!0,previewsContainer:!1,clickable:"#media-add",dictDefaultMessage:'<span><i class="fa fa-cloud-upload fa-4x"></i><br />Drag and drop files here, or simply click me!</div>',dictResponseError:"Error while uploading file!"});e.on("success",function(e,o){o.Success===!1?$.hood.Alerts.Error("Uploads failed: "+o.Message):$.hood.Alerts.Success("Uploads completed successfully.")}),e.on("addedfile",function(e){$("#media-total-progress .progress-bar").css({width:"0%"}),$("#media-total-progress .progress-bar .percentage").html("0%")}),e.on("totaluploadprogress",function(e){$("#media-total-progress .progress-bar").css({width:e+"%"}),$("#media-total-progress .progress-bar .percentage").html(e+"%")}),e.on("sending",function(e){$("#media-total-progress").fadeIn(),$("#media-total-progress .progress-bar").css({width:"0%"}),$("#media-total-progress .progress-bar .percentage").html("0%")}),e.on("complete",function(e){$.hood.Media.Reload()}),e.on("queuecomplete",function(e){$("#media-total-progress").hide(),$.hood.Media.Reload()})}},UploadUrl:function(){return"/admin/media/upload/simple?directory="+$("#Directory").val()}},Delete:function(e){var o=$(this);deleteMediaCallback=function(e){e&&$.post("/admin/media/delete",{id:o.data("id")},function(e){e.Success?($.hood.Media.Reload(),$(".modal-backdrop").remove(),$.hood.Alerts.Success("The file has now been removed from the website.")):$.hood.Alerts.Error("There was a problem deleting the file.")})},$.hood.Alerts.Confirm("The media file will be permanently removed. This cannot be undone.","Are you sure?",deleteMediaCallback,type="warning",footer='<span class="text-warning"><i class="fa fa-exclamation-triangle"></i> Ensure this file is not attached to any posts, pages or features of the site, or it will appear as a broken image or file.</span>',confirmButtonText="Ok",cancelButtonText="Cancel")},RestrictDir:function(){var e=/[^0-9A-Za-z- ]*/g,o=$(this).val(),t=o.replace(e,"");o!==t&&$(this).val(t)},Directories:{Create:function(){$("body").on("keyup",".sweet-alert input",$.hood.Media.RestrictDir),Swal.fire({title:"Create directory",text:"Please enter a name for your new directory:",input:"text",inputAttributes:{placeholder:"Directory name...",autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Add Directory",showLoaderOnConfirm:!0,preConfirm:function(e){return e!==!1&&(""===e?(Swal.showValidationMessage("You didn't supply a directory name, we can't create one without it!"),!1):fetch("/admin/media/directory/add?directory=".concat(e)).then(function(e){return e.json()}).catch(function(e){Swal.showValidationMessage("Request failed: ".concat(e))}))},allowOutsideClick:function(){return!Swal.isLoading()}}).then(function(e){e.value.Success?($.hood.Media.Reload(),Swal.fire({title:"Woohoo!",text:"Directory has been successfully added...",type:"success"})):Swal.showValidationMessage("There was a problem creating the new directory:\n\n".concat(e.value.Errors)),$("body").off("keyup",".sweet-alert input",$.hood.Media.RestrictDir)})},Delete:function(e){$(this);message="The directory and all files will be permanently removed.\n\nWarning: Ensure these files are not attached to any posts, pages or features of the site, or it will appear as a broken image or file.","Default"===$("#Directory").val()?$.hood.Alerts.Error("You have to select a directory to delete.","Error!",!0,'<span class="text-warning"><i class="fa fa-exclamation-triangle"></i> You cannot delete the "Default" directory.</span>',!0,5e3):(""===$("#Directory").val()&&(message="You have selected to delete All directories, this will remove ALL files and ALL directories from the site. Are you sure!?"),deleteDirectoryCallback=function(e){e&&$.post("/admin/media/directory/delete",{directory:$("#Directory").val()},function(e){e.Success?($.hood.Media.Reload(),$.hood.Alerts.Success("The directory has now been removed from the website.")):$.hood.Alerts.Error("There was a problem deleting the directory.")})},$.hood.Alerts.Message("Cancelled, nothing to worry about."))}},Players:{},LoadMediaPlayers:function(e){var o={techOrder:["azureHtml5JS","flashSS","html5FairPlayHLS","silverlightSS","html5"],nativeControlsForTouch:!1,controls:!0,autoplay:!1,seeking:!0};$(e).each(function(){player=$.hood.Media.Players[$(this).data("id")],player&&player.dispose(),$.hood.Media.Players[$(this).data("id")]=amp($(this).attr("id"),o),player=$.hood.Media.Players[$(this).data("id")],player.src([{src:$(this).data("file"),type:$(this).data("type")}])})}},$.hood.Media.Init();