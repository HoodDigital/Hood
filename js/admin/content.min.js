"use strict";$.hood||($.hood={}),$.hood.Content={Init:function(){$("body").on("click",".content-delete",$.hood.Content.Delete),$("body").on("click",".content-meta-delete",$.hood.Content.Meta.Delete),$("body").on("click",".content-clone",$.hood.Content.Clone),$("body").on("click",".content-set-status",$.hood.Content.SetStatus),$("body").on("click",".content-categories-save",$.hood.Content.Categories.Save),$("body").on("click",".content-categories-add",$.hood.Content.Categories.Add),$("body").on("click",".content-categories-delete",$.hood.Content.Categories.Delete),$("body").on("change",".content-categories-check",$.hood.Content.Categories.ToggleCategory),$("body").on("click",".add-custom-field",$.hood.Content.Types.AddField),$("body").on("click",".delete-custom-field",$.hood.Content.Types.DeleteField),$("body").on("keyup","#Slug",function(){$(".slug-display").html($(this).val())}),$("#content-edit-form").doesExist()&&$.hood.Content.Edit.Init(),$("#content-meta-form").doesExist()&&$.hood.Content.Meta.Init(),$.hood.Inline.Reload("#content-meta-fields")},Lists:{Content:{Loaded:function(e){$.hood.Loader(!1)},Reload:function(e){$("#content-list").doesExist()&&$.hood.Inline.Reload($("#content-list"),e)}},Categories:{Loaded:function(e){$.hood.Loader(!1)},Reload:function(e){$("#content-categories-list").doesExist()&&$.hood.Inline.Reload($("#content-categories-list"),e)}},Fields:{Loaded:function(e){$.hood.Loader(!1)},Reload:function(e){$("#content-meta-list").doesExist()&&$.hood.Inline.Reload($("#content-meta-list"),e)}}},Delete:function(e){e.preventDefault(),$tag=$(this),deleteContentCallback=function(e){e&&$.post($tag.attr("href"),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Content.Reload(),e.Success&&$tag&&$tag.data("redirect")&&($.hood.Alerts.Success("<strong>Content deleted, redirecting...</strong><br />Just taking you back to the content list."),setTimeout(function(){window.location=$tag.data("redirect")},1500))})},$.hood.Alerts.Confirm("The content will be permanently removed.","Are you sure?",deleteContentCallback,"error",'<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> <strong>This process CANNOT be undone!</strong></span>')},SetStatus:function(e){e.preventDefault(),$tag=$(this),publishContentCallback=function(e){e&&$.post($tag.attr("href"),$tag.data("status"),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Content.Reload()})},$.hood.Alerts.Confirm("The item will be immediately visible on the website.","Are you sure?",publishContentCallback,"warning")},Clone:function(e){e.preventDefault(),$tag=$(this),duplicateContentCallback=function(e){e&&$.post($tag.attr("href"),$tag.data("status"),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Content.Reload()})},$.hood.Alerts.Confirm("This will duplicate the content and everything inside it.","Are you sure?",duplicateContentCallback,"warning")},Create:{Loaded:function(e){$("#content-create-form").find(".datepicker").datetimepicker({locale:"en-gb",format:"L"}),$("#content-create-form").hoodValidator({validationRules:{Title:{required:!0},Except:{required:!0},PublishDate:{required:!0,ukdate:!0}},submitButtonTag:$("#content-create-submit"),submitUrl:$("#content-create-form").attr("action"),submitFunction:function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Content.Reload()}})}},Edit:{Init:function(){$(tag).find(".datepicker").datetimepicker({locale:"en-gb",format:"L"}),$.hood.Content.Edit.InitImageUploader()},InitImageUploader:function(){if($("#content-gallery-upload").doesExist()){Dropzone.autoDiscover=!1;var e=new Dropzone("#content-gallery-upload",{url:$("#content-gallery-upload").data("url"),thumbnailWidth:80,thumbnailHeight:80,parallelUploads:5,previewTemplate:!1,paramName:"files",autoProcessQueue:!0,previewsContainer:!1,clickable:"#content-gallery-add",dictDefaultMessage:'<span><i class="fa fa-cloud-upload fa-4x"></i><br />Drag and drop files here, or simply click me!</div>',dictResponseError:"Error while uploading file!"});e.on("success",function(e,t){t.Success===!1?$.hood.Alerts.Error("Uploads failed: "+t.Error):$.hood.Alerts.Success("Uploads completed successfully.")}),e.on("addedfile",function(e){}),e.on("totaluploadprogress",function(e){document.querySelector("#gallery-total-progress .progress-bar").style.width=e+"%"}),e.on("sending",function(e){document.querySelector("#gallery-total-progress").style.opacity="1"}),e.on("complete",function(e){$.hood.Inline.Refresh(".gallery")}),e.on("queuecomplete",function(e){document.querySelector("#gallery-total-progress").style.opacity="0",$.hood.Inline.Refresh(".gallery")})}}},Categories:{Save:function(e){e.preventDefault(),$tag=$(this),$.post($("#content-categories-edit-form").attr("action"),$("#content-categories-edit-form").serialize(),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Categories.Reload()})},Add:function(e){e.preventDefault(),$tag=$(this),$.post($("#content-categories-add-form").attr("action"),$("#content-categories-add-form").serialize(),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Categories.Reload()})},ToggleCategory:function(){$.post($(this).data("url"),{categoryId:$(this).val(),contentId:$(this).data("id"),add:$(this).is(":checked")},function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Categories.Reload()})},Delete:function(e){e.preventDefault(),$tag=$(this),deleteCategoryCallback=function(e){e&&$.post($tag.attr("href"),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Categories.Reload()})},$.hood.Alerts.Confirm("The category will be permanently removed.","Are you sure?",deleteCategoryCallback,"error",'<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> <strong>This process CANNOT be undone!</strong></span>')}},Meta:{Create:function(){$("#add-field-form").hoodValidator({validationRules:{cfName:{required:!0},cfType:{required:!0}},submitButtonTag:$("#add-field-submit"),submitUrl:"/admin/content/addmeta",submitFunction:function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Fields.Reload()}})},Delete:function(){e.preventDefault(),$tag=$(this),deleteCategoryCallback=function(e){e&&$.post($tag.attr("href"),function(e){$.hood.Helpers.ProcessResponse(e),$.hood.Content.Lists.Fields.Reload()})},$.hood.Alerts.Confirm("The field will be permanently removed.","Are you sure?",deleteCategoryCallback,"error",'<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> <strong>This process CANNOT be undone!</strong></span>')}},Types:{AddField:function(){var e=$("#custom-field-name-"+$(this).data("id")).val(),t=$.hood.Content.Types.GetFieldsList($(this).data("id"));return exists=!1,$.each(t,function(t,o){o.Name===e&&(exists=!0)}),e?t?exists?void $.hood.Alerts.Error("Cannot insert two fields with the same key."):(newField={Name:$("#custom-field-name-"+$(this).data("id")).data("prefix")+$("#custom-field-name-"+$(this).data("id")).val(),Default:$("#custom-field-default-"+$(this).data("id")).val(),Type:$("#custom-field-type-"+$(this).data("id")).val(),System:!1},t.push(newField),$.hood.Content.Types.ReRenderFields(t,$(this).data("id")),$("#custom-fields-"+$(this).data("id")).val(JSON.stringify(t)),void $.hood.Alerts.Success("Added field.")):void $.hood.Alerts.Error("The field list is empty."):void $.hood.Alerts.Error("You have to name the field.")},DeleteField:function(){var e=$.hood.Content.Types.GetFieldsList($(this).data("id")),t=$(this).data("name");e=$.grep(e,function(e){return e.Name!==t}),$.hood.Content.Types.ReRenderFields(e,$(this).data("id")),$("#custom-fields-"+$(this).data("id")).val(JSON.stringify(e)),$.hood.Alerts.Success("Deleted field.")},GetFieldsList:function(e){if(fieldsInput=$("#custom-fields-"+e).val(),null!==fieldsInput&&""!==fieldsInput){var t=JSON.parse(fieldsInput);for(var o in t)if(t[o].hasOwnProperty("Name"))return t}return new Array},ReRenderFields:function(e,t){for(newList=$("#field-list-"+t).empty(),i=0;i<e.length;i++)fld="<tr><td class='col-xs-8'><strong>"+e[i].Name+"</strong> "+e[i].Type+"</td><td class='col-xs-4 text-right'>",e[i].System?fld+='<span class="label label-default">System Field</span>':fld+="<a class='delete-custom-field btn btn-xs bg-color-red txt-color-white' data-name='"+e[i].Name+"' data-id='"+t+"'><i class='fa fa-trash-o'></i></a>",fld+="</td></tr>",newList.append(fld)}}},$(document).ready($.hood.Content.Init);