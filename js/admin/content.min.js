"use strict";$.hood||($.hood={}),$.hood.Content={Init:function(){$("body").on("click",".delete-content",this.Delete),$("body").on("click",".delete-content-field",this.Meta.Delete),$("body").on("click",".clone-content",this.Clone),$("body").on("click",".create-content",this.Create.Init),$("body").on("click",".publish-content",this.Publish),$("body").on("click",".archive-content",this.Archive),$("body").on("click",".edit-content-category",this.Categories.Edit),$("body").on("click",".save-content-category",this.Categories.Save),$("body").on("click",".add-content-category",this.Categories.Add),$("body").on("click",".delete-content-category",this.Categories.Delete),$("body").on("change",".content-category-check",this.Categories.ToggleCategory),$("body").on("click",".add-custom-field",this.Types.AddField),$("body").on("click",".delete-custom-field",this.Types.DeleteField),$("body").on("keyup","#Slug",function(){$(".slug-display").html($(this).val())}),$("#edit-content").doesExist()&&this.Edit.Init(),$("#add-field-form").doesExist()&&this.Meta.Init()},Types:{AddField:function(){var e=$("#custom-field-name-"+$(this).data("id")).val(),t=$.hood.Content.Types.GetFieldsList($(this).data("id"));return exists=!1,$.each(t,function(t,o){o.Name===e&&(exists=!0)}),e?t?exists?void $.hood.Alerts.Error("Cannot insert two fields with the same key."):(newField={Name:$("#custom-field-name-"+$(this).data("id")).data("prefix")+$("#custom-field-name-"+$(this).data("id")).val(),Default:$("#custom-field-default-"+$(this).data("id")).val(),Type:$("#custom-field-type-"+$(this).data("id")).val(),System:!1},t.push(newField),$.hood.Content.Types.ReRenderFields(t,$(this).data("id")),$("#custom-fields-"+$(this).data("id")).val(JSON.stringify(t)),void $.hood.Alerts.Success("Added field.")):void $.hood.Alerts.Error("The field list is empty."):void $.hood.Alerts.Error("You have to name the field.")},DeleteField:function(){var e=$.hood.Content.Types.GetFieldsList($(this).data("id")),t=$(this).data("name");e=$.grep(e,function(e){return e.Name!==t}),$.hood.Content.Types.ReRenderFields(e,$(this).data("id")),$("#custom-fields-"+$(this).data("id")).val(JSON.stringify(e)),$.hood.Alerts.Success("Deleted field.")},GetFieldsList:function(e){if(fieldsInput=$("#custom-fields-"+e).val(),null!==fieldsInput&&""!==fieldsInput){var t=JSON.parse(fieldsInput);for(var o in t)if(t[o].hasOwnProperty("Name"))return t}return new Array},ReRenderFields:function(e,t){for(newList=$("#field-list-"+t).empty(),i=0;i<e.length;i++)fld="<tr><td class='col-xs-8'><strong>"+e[i].Name+"</strong> "+e[i].Type+"</td><td class='col-xs-4 text-right'>",e[i].System?fld+='<span class="label label-default">System Field</span>':fld+="<a class='delete-custom-field btn btn-xs bg-color-red txt-color-white' data-name='"+e[i].Name+"' data-id='"+t+"'><i class='fa fa-trash-o'></i></a>",fld+="</td></tr>",newList.append(fld)}},Categories:{Edit:function(e){$(this);e.preventDefault(),$.hood.Blades.OpenWithLoader(".edit-content-category","/admin/categories/edit/"+$(this).data("id")+"?type="+$(this).data("type"),null)},Save:function(e){$.post("/admin/categories/save/",$("#edit-content-category-form").serialize(),function(e){e.Success?($.hood.Inline.Reload(".categorylist"),swal({title:"Saved!",text:"The category has been saved.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem saving the category: "+e.Error,timer:1300,type:"error"})})},Add:function(e){$.post("/admin/categories/add/",$("#add-content-category-form").serialize(),function(e){e.Success?($.hood.Inline.Reload(".categorylist"),swal({title:"Saved!",text:"The category has been added.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem adding the category: "+e.Error,timer:1300,type:"error"})})},ToggleCategory:function(){$(this).is(":checked")?$.post("/admin/content/categories/add/",{categoryId:$(this).val(),contentId:$(this).data("id")},function(e){e.Success?$.hood.Alerts.Success("Added category."):$.hood.Alerts.Error("Couldn't add the category: "+e.Error)}):$.post("/admin/content/categories/remove/",{categoryId:$(this).val(),contentId:$(this).data("id")},function(e){e.Success?$.hood.Alerts.Success("Removed category."):$.hood.Alerts.Error("Couldn't add the category: "+e.Error)})},Delete:function(){var e=$(this);swal({title:"Are you sure?",text:"The field will be permanently removed.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(t){t?$.post("/admin/categories/delete/"+e.data("id"),null,function(e){e.Success?($.hood.Inline.Reload(".categorylist"),swal({title:"Deleted!",text:"The field has now been removed from the website.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem deleting the field: "+e.Errors,timer:5e3,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})}},Delete:function(e){var t=$(this);swal({title:"Are you sure?",text:"The content will be permanently removed.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(e){e?$.post("/admin/content/"+t.data("id")+"/delete",null,function(e){e.Success?($.hood.Blades.Close(),swal({title:"Deleted!",text:"The content has now been removed from the website.",timer:1300,type:"success"}),setTimeout(function(){window.location=e.Url},500)):swal({title:"Error!",text:"There was a problem deleting the content: "+e.Errors,timer:5e3,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})},Publish:function(e){var t=$(this);swal({title:"Are you sure?",text:"The item will be visible on the website.",type:"warning",confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(e){e?$.post("/admin/content/"+t.data("id")+"/publish",null,function(e){e.Success?(swal({title:"Published!",text:"The item has now been published.",timer:1300,type:"success"}),setTimeout(function(){window.location=e.Url},500)):swal({title:"Error!",text:"There was a problem publishing the item: "+e.Errors,timer:5e3,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})},Archive:function(e){var t=$(this);swal({title:"Are you sure?",text:"The item will be hidden from the website.",type:"warning",confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(e){e?$.post("/admin/content/"+t.data("id")+"/archive",null,function(e){e.Success?(swal({title:"Archived!",text:"The item has now been archived.",timer:1300,type:"success"}),setTimeout(function(){window.location=e.Url},500)):swal({title:"Error!",text:"There was a problem archiving the item: "+e.Errors,timer:5e3,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})},Clone:function(e){var t=$(this);$.post("/admin/content/"+t.data("id")+"/clone",null,function(e){e.Success?(window.location="/admin/edit/"+e.id,swal({title:"Cloned!",text:"The content has now been cloned just forwarding you to the new content...",type:"success"}),$.hood.Blades.Close()):swal({title:"Error!",text:"There was a problem cloning the content: "+e.Errors,timer:5e3,type:"error"})})},Create:{Init:function(e){var t=$(this);e.preventDefault(),$.hood.Blades.OpenWithLoader("button.create-content","/admin/content/"+t.data("type")+"/create/",$.hood.Content.Create.SetupCreateForm)},SetupCreateForm:function(){$("#create-content-form").find(".datepicker").datetimepicker({locale:"en-gb",format:"L"}),$("#create-content-form").hoodValidator({validationRules:{Title:{required:!0},Except:{required:!0},PublishDate:{required:!0,ukdate:!0}},submitButtonTag:$("#create-content-submit"),submitUrl:"/admin/content/create",submitFunction:function(e){e.Success?(swal("Created!","The content has now been created!","success"),setTimeout(function(){window.location=e.Url},500)):swal("Error","There was a problem creating the content:\n\n"+e.Errors,"error")}})}},Edit:{Init:function(){this.LoadEditors("#edit-content"),$.hood.Content.Upload.InitImageUploader()},Designer:{Window:$("#designer-window"),Area:function(){return $("#designer-window").contents().find("#editable-content")},Init:function(){$("body").on("change","#preview-size",function(){$("#designer-window").attr("class","designer-window "+$(this).val())}),$("body").on("change","#Body",function(){$.hood.Content.Designer.Area().html($(this).val())})}},LoadEditors:function(e){$(e).find(".datepicker").datetimepicker({locale:"en-gb",format:"L"})}},Meta:{Create:function(){$("#add-field-form").hoodValidator({validationRules:{cfName:{required:!0},cfType:{required:!0}},submitButtonTag:$("#add-field-submit"),submitUrl:"/admin/content/addmeta",submitFunction:function(e){e.Success?($.hood.Inline.Reload("#content-meta-fields"),swal("Created!","The field has now been created!","success")):swal("Error","There was a problem creating the content:\n\n"+e.Errors,"error")}})},Delete:function(){var e=$(this);swal({title:"Are you sure?",text:"The field will be permanently removed.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(t){t?$.post("/admin/content/deletemeta",{id:e.data("id")},function(e){e.Success?($.hood.Inline.Reload("#content-meta-fields"),$.hood.Blades.Close(),swal({title:"Deleted!",text:"The field has now been removed from the website.",timer:1300,type:"success"})):swal({title:"Error!",text:"There was a problem deleting the field: "+e.Errors,timer:1300,type:"error"})}):swal("Cancelled","It's all good in the hood!","error")})}},Upload:{InitImageUploader:function(){if($("#content-gallery-upload").doesExist()){Dropzone.autoDiscover=!1;var e=new Dropzone("#content-gallery-upload",{url:"/admin/content/"+$("#content-gallery-upload").data("id")+"/upload/gallery",thumbnailWidth:80,thumbnailHeight:80,parallelUploads:5,previewTemplate:!1,paramName:"files",autoProcessQueue:!0,previewsContainer:!1,clickable:"#content-gallery-add",dictDefaultMessage:'<span><i class="fa fa-cloud-upload fa-4x"></i><br />Drag and drop files here, or simply click me!</div>',dictResponseError:"Error while uploading file!"});e.on("success",function(e,t){t.Success===!1?$.hood.Alerts.Error("Uploads failed: "+t.Error):$.hood.Alerts.Success("Uploads completed successfully.")}),e.on("addedfile",function(e){}),e.on("totaluploadprogress",function(e){document.querySelector("#gallery-total-progress .progress-bar").style.width=e+"%"}),e.on("sending",function(e){document.querySelector("#gallery-total-progress").style.opacity="1"}),e.on("complete",function(e){$.hood.Inline.Refresh(".gallery")}),e.on("queuecomplete",function(e){document.querySelector("#gallery-total-progress").style.opacity="0",$.hood.Inline.Refresh(".gallery")})}}}},$(window).on("load",function(){$.hood.Content.Init()});